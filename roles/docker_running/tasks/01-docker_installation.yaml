---
- name: Removing_Unofficial_Packages
  become: true
  ansible.builtin.apt:
    name: "{{ item }}"
    state: absent
    force: true
    force_apt_get: true
    purge: true
    clean: true
    lock_timeout: 60
  loop: "{{ docker_obselete_packages }}"

- name: Updating_APT_Source_List
  become: true
  ansible.builtin.apt:
    force: true
    force_apt_get: true
    update_cache: true
    update_cache_retries: 3
    cache_valid_time: 86400
    upgrade: safe
    autoclean: true
    autoremove: true
    lock_timeout: 60

- name: Creating_APT_Keyrings_Directory
  become: true
  ansible.builtin.file:
    path: /etc/apt/keyrings
    state: directory
    owner: root
    group: root
    mode: '0755'

- name: Obtaining_Docker_GPG_Key
  become: true
  ansible.builtin.get_url:
    url: https://download.docker.com/linux/ubuntu/gpg
    dest: /etc/apt/keyrings/docker.asc
    owner: root
    group: root
    mode: '0644'
  environment: "{{ proxy_env }}"

- name: Adding_Docker_Source_List
  become: true
  ansible.builtin.apt_repository:
    repo: "deb [arch=amd64 signed-by=/etc/apt/keyrings/docker.asc] \
      https://download.docker.com/linux/ubuntu jammy stable"
    state: present
    update_cache: true
    update_cache_retries: 3
  failed_when: false
  environment: "{{ proxy_env }}"

- name: Installing_Docker_Latest_Packages
  become: true
  ansible.builtin.apt:
    name: "{{ item }}"
    state: present
    update_cache: true
    update_cache_retries: 3
    lock_timeout: 60
    force_apt_get: true
    autoclean: true
    autoremove: true
    force: true
  loop: "{{ docker_latest_packages }}"
  environment: "{{ proxy_env }}"

- name: Creating_Docker_Daemon_Directory_ETCDOCKER
  become: true
  ansible.builtin.file:
    path: /etc/docker
    state: directory
    owner: root
    group: root
    mode: '0755'

- name: Creating_Docker_Daemon_Directory_ETCSYSTEMD
  become: true
  ansible.builtin.file:
    path: /etc/systemd/system/docker.service.d
    state: directory
    owner: root
    group: root
    mode: '0755'
